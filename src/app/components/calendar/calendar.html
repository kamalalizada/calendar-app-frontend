<div class="calendar-wrapper">

  <!-- Settings button -->
  <button class="settings-btn" (click)="togglePanel()">⚙️ Ayarlar</button>

  <!-- Settings panel -->
  <div class="settings-panel" *ngIf="panelVisible">
    <h3>Categories idarə et</h3>

    <div *ngFor="let t of ['expense', 'income'] as const">
      <h4>{{ t | titlecase }}</h4>
      <ul class="category-list">
        <li *ngFor="let cat of getCategoriesByType(t)">
          {{ cat.name }}
          <button class="delete-cat" (click)="deleteCategory(cat.id)">✖</button>
        </li>
      </ul>

      <div class="new-category">
        <input type="text" [(ngModel)]="newCategoryName" placeholder="Yeni category">
        <button (click)="addCategory()">Əlavə et</button>
      </div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar-container">
    <div class="calendar-header">
      <button (click)="prevMonth()">&#8592;</button>
      <h2>{{ currentDate | date:'MMMM yyyy' }}</h2>
      <button (click)="nextMonth()">&#8594;</button>
    </div>

    <div class="calendar-grid">
      <div class="calendar-day" *ngFor="let day of days" [class.today]="isToday(day)" 
           (click)="selectDay(day, $event)" [class.disabled]="showForm && selectedDay !== day">

        <div class="day-number">
          {{ day }}
          <button *ngIf="selectedDay === day && showForm !== day" class="add-btn" (click)="openForm($event, day)">+</button>
        </div>

        <div class="totals" *ngIf="(getTotalsForDay(day,'expense')>0)||(getTotalsForDay(day,'income')>0)">
          <span class="expense-total" *ngIf="getTotalsForDay(day,'expense')>0">
            -{{ getTotalsForDay(day,'expense') }} ₼
          </span>
          <span class="income-total" *ngIf="getTotalsForDay(day,'income')>0">
            +{{ getTotalsForDay(day,'income') }} ₼
          </span>
        </div>

        <div *ngIf="showForm && selectedDay===day" class="popup-wrapper" (click)="stopClick($event)">
          <app-entry-popup [selectedDay]="day" (save)="addEntryToCalendar($event)" (close)="closeForm()">
          </app-entry-popup>
        </div>
      </div>
    </div>
  </div>

  <!-- Side panel: seçilmiş günün detalları -->
  <div class="side-panel" *ngIf="selectedDay">
    <h2>{{ selectedDay }} {{ currentDate | date:'MMMM yyyy' }}</h2>

    <h3>Expense</h3>
    <ul>
      <li *ngFor="let e of getEntriesForSelectedDay('expense')">
        {{ getCategoryName(e.entryCategories?.[0]?.categoryId) }} — {{ e.amount }} ₼
        <span *ngIf="e.note">({{ e.note }})</span>
      </li>
    </ul>

    <h3>Income</h3>
    <ul>
      <li *ngFor="let e of getEntriesForSelectedDay('income')">
        {{ getCategoryName(e.entryCategories?.[0]?.categoryId) }} + {{ e.amount }} ₼
        <span *ngIf="e.note">({{ e.note }})</span>
      </li>
    </ul>
  </div>

</div>
